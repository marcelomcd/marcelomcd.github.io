---
description: Ativado quando o usuÃ¡rio pede revisÃ£o, review, anÃ¡lise ou auditoria de cÃ³digo. Define como estruturar a resposta de code review de forma profissional e acionÃ¡vel.
globs: []
alwaysApply: false
---

# Code Review â€” Estrutura e CritÃ©rios

Ativado quando o usuÃ¡rio usa termos como: "revise", "review", "analise", "audite", "o que vocÃª acha desse cÃ³digo", "tem algo errado aqui", "como melhorar".

---

## Estrutura ObrigatÃ³ria da Resposta de Review

Sempre estruture o review nesta ordem:

### 1. ğŸ”´ Problemas CrÃ­ticos (bloqueadores)
Issues que **devem** ser corrigidos antes de ir para produÃ§Ã£o:
- Falhas de seguranÃ§a (injection, exposiÃ§Ã£o de dados, falta de autenticaÃ§Ã£o)
- Bugs que causam comportamento incorreto
- Memory leaks ou resource leaks
- Race conditions
- Tratamento de erro ausente em fluxos crÃ­ticos

### 2. ğŸŸ¡ Problemas Importantes (alta prioridade)
Issues que degradam qualidade mas nÃ£o bloqueiam imediatamente:
- ViolaÃ§Ãµes de princÃ­pios arquiteturais (lÃ³gica de negÃ³cio no lugar errado)
- CÃ³digo duplicado significativo
- AusÃªncia de validaÃ§Ã£o de entrada
- N+1 queries ou problemas de performance evidentes
- Falta de tipagem em pontos crÃ­ticos (TypeScript)

### 3. ğŸ”µ SugestÃµes de Melhoria (qualidade)
Melhorias que elevam a qualidade sem serem urgentes:
- RefatoraÃ§Ãµes de legibilidade
- Oportunidades de reutilizaÃ§Ã£o
- Nomenclatura confusa
- ComentÃ¡rios desnecessÃ¡rios ou ausentes onde deveriam existir
- Testes ausentes em lÃ³gica importante

### 4. âœ… O que estÃ¡ bom
ReconheÃ§a explicitamente o que foi bem feito â€” review nÃ£o Ã© sÃ³ criticar.

### 5. ğŸ”§ CÃ³digo Refatorado (quando aplicÃ¡vel)
Se houver problemas crÃ­ticos ou importantes, entregue o cÃ³digo corrigido, nÃ£o apenas a descriÃ§Ã£o do problema.

---

## CritÃ©rios de AvaliaÃ§Ã£o

Avalie o cÃ³digo nas seguintes dimensÃµes, mencionando apenas as relevantes:

| DimensÃ£o | O que verificar |
|----------|----------------|
| **SeguranÃ§a** | Input validation, secrets no cÃ³digo, SQL injection, XSS, IDOR |
| **Corretude** | LÃ³gica correta, edge cases tratados, erros tratados |
| **Arquitetura** | Responsabilidades corretas, acoplamento, coesÃ£o |
| **Performance** | N+1, loops desnecessÃ¡rios, estruturas de dados inadequadas |
| **Testabilidade** | InjeÃ§Ã£o de dependÃªncias, funÃ§Ãµes puras, acoplamento testÃ¡vel |
| **Legibilidade** | Nomes claros, funÃ§Ãµes pequenas, fluxo linear |
| **Manutenibilidade** | DRY, SOLID aplicados, extensibilidade |
| **TypeScript** | Tipagem adequada, sem `any`, tipos explÃ­citos |

---

## Tom e Postura

- **EspecÃ­fico** â€” "na linha 47, o `req.params.id` nÃ£o Ã© validado antes de usar na query" > "falta validaÃ§Ã£o"
- **Construtivo** â€” aponte o problema E a soluÃ§Ã£o ou direÃ§Ã£o
- **Justo** â€” reconheÃ§a o que estÃ¡ bom, nÃ£o apenas o que estÃ¡ errado
- **Direto** â€” sem rodeios, mas sem ser destrutivo
- **Educativo** â€” explique o **porquÃª** do problema, nÃ£o apenas o que mudar

---

## Exemplos de Feedback Bem Estruturado

```
ğŸ”´ CRÃTICO â€” InjeÃ§Ã£o de SQL (linha 23)
O valor de `req.query.state` Ã© interpolado diretamente na query WIQL sem sanitizaÃ§Ã£o.
Um atacante pode manipular a query para acessar dados de outros projetos.

// Atual (vulnerÃ¡vel)
const query = `SELECT [System.Id] FROM WorkItems WHERE [System.State] = '${req.query.state}'`

// Corrigido (seguro)
const state = String(req.query.state ?? '').replace(/'/g, "''")
const query = `SELECT [System.Id] FROM WorkItems WHERE [System.State] = '${state}'`
// Melhor ainda: use uma allowlist de estados vÃ¡lidos antes de interpolar
```

```
ğŸŸ¡ IMPORTANTE â€” LÃ³gica de negÃ³cio na rota (linha 45-80)
A rota `GET /features` contÃ©m 35 linhas de lÃ³gica de transformaÃ§Ã£o de dados.
Rotas devem apenas receber, delegar e responder. Extraia para um service ou helper.
```

```
âœ… BOM â€” Tratamento de erro consistente
O uso de `next(error)` em todos os catch blocks estÃ¡ correto e delega
corretamente ao error handler global. Boa prÃ¡tica mantida.
```

---

## Quando Entregar CÃ³digo Refatorado

Sempre entregue cÃ³digo refatorado quando:
- O problema Ã© ğŸ”´ CrÃ­tico
- O problema Ã© ğŸŸ¡ Importante E a soluÃ§Ã£o nÃ£o Ã© trivialmente Ã³bvia
- O usuÃ¡rio pede explicitamente "corrija" ou "refatore"

NÃ£o entregue cÃ³digo quando:
- Ã‰ apenas uma sugestÃ£o ğŸ”µ de estilo e o problema Ã© auto-explicativo
- A refatoraÃ§Ã£o exigiria contexto que nÃ£o foi compartilhado
